## LayaAir3D Scene

The scene is the 3D world container of the LayaAir engine, used to render the game's 3D screen and load  various 3D elements. The camera, light, characters, objects and so on. In the game need to be put into the scene to display the picture, which is equivalent to a game 3D player or 3D view.

Through the inheritance of Scene we can see that it is inherited from the Sprite class. So it's easy to treat it as a display object in 2D.

In the LayaAir engine, 3D and 2D can be mixed to create Scene 3D scenes and Sprite 2D containers or elements that can be loaded on the the stage simultaneously.

In the "quick start 3D" course, we built a basic 3D application and added the main components. In this lesson, we will introduce the fog function of the scene, and the scene file loading method generated by the LayaAir export tool in unity.



### Loading scene resources

The following code in the "LayaScene_01/loveScene.ls"  file is unity3D layaAir export plug-in select Export ”Scene“ category generated file extension .ls (understood as laya scene shorthand). Light maps for the scene are stored inside, multiple or single included model files, and more. Scene.load () method can be loaded directly into the scene and displayed.

```typescript
//初始化引擎
Laya3D.init(0, 0, true);
Laya.stage.scaleMode = Laya.Stage.SCALE_FULL;
Laya.stage.screenMode = Laya.Stage.SCREEN_NONE;
Laya.Stat.show();
//加载插件导出的场景。
var scene = Laya.Scene.load("LayaScene_01/loveScene.ls");
Laya.stage.addChild(scene);
//创建摄像机(横纵比，近距裁剪，远距裁剪)
var camera = new Laya.Camera(0, 0.1, 1000);
//加载到场景
scene.addChild(camera);
//移动摄像机位置
camera.transform.position = new Laya.Vector3(0, 5, 23);
//旋转摄像机角度
camera.transform.rotate(new Laya.Vector3(-17, 0, 0), true, false);
//设置摄像机视野范围（角度）
camera.fieldOfView = 35;
//设置背景颜色
camera.clearColor = new Laya.Vector4(0, 0, 0.6, 1);
//加入摄像机移动控制脚本
camera.addComponent(CameraMoveScript);
//创建方向光 -------------------
var light = scene.addChild(new Laya.DirectionLight());
//移动灯光位置
light.transform.translate(new Laya.Vector3(0, 2, 5));
//调整灯光方向
light.direction = new Laya.Vector3(0, -.5, 1);
//设置灯光环境色
light.color = new Laya.Vector3(1, 1, 1);
```
The compile and debug sample code shows a beautiful scene on the screen (Figure 1).

![图片1](img/1.png)<br> （Picture 1）



### Scene resource preloading

The above example Scene.load () method is the asynchronous loading of resources, and sometimes 3D resources are relatively large, need to preload to enhance the experience of the first screen. At this point, we can preload the loader. 2D game resources are preloaded with the Laya.loader.load () method, and the 3D resource must use the Laya.loader.create () method, and refer to the relevant AP description.

```typescript
//单个资源
Laya.loader.create("res/Cube.ls",Laya.Handler.create(this,completeHandler));
//批量加载
Laya.loader.create(["res/Cube1.ls","res/Cube2.ls","res/Cube3.ls"],Laya.Handler.create(this,completeHandler));
//批量加载 并创建不同的类型；
Laya.loader.create([{url:"res/Cube1.ls"，"type":Laya.Scene},{url:"res/Cube2.lh","type":Laya.Sprite3D},{url:"res/Cube3.lm","type":Laya.MeshSprite3D}],Laya.Handler.create(this,completeHandler));
```

在项目中，一般我们都会采用加载器的方式，可以对资源有很好的管理。

代码如下:

```typescript
//初始化引擎
Laya3D.init(0, 0, true);
Laya.stage.scaleMode = Laya.Stage.SCALE_FULL;
Laya.stage.screenMode = Laya.Stage.SCREEN_NONE;
Laya.Stat.show();
//因为只有一个资源 所以我们传进去字符串就可以，队列的话可以传递一个数组队列。
Laya.loader.create("LayaScene_01/loveScene.ls",
    Laya.Handler.create(this, this.completeHandler), null, Laya.Scene);
function completeHandler() {
    // 第一种方法 获取场景
    // var scene=Laya.Scene.load("LayaScene_01/loveScene.ls");
    // 第二种方法，缓存后加载方式
    var scene = Laya.loader.getRes("LayaScene_01/loveScene.ls");
    Laya.stage.addChild(scene);
}
```


### Foggy scene

Fog effect plays an important role in the project, is equivalent to the effect of atmosphere, it seems a kind of hazy feeling, so that the scene looks more real. LayaAir 3D engine can set the scene's fog effect visible distance (equivalent to concentration) and fog effect color. The proper use of fog can not only improve the performance of the game, but also can increase the game experience.

```typescript
//开启雾化效果
scene.enableFog = true;
//设置雾化的颜色
scene.fogColor = new Laya.Vector3(0,0,0.6);
//设置雾化的起始位置，相对于相机的距离
scene.fogStart = 10;
//设置雾化最浓处的距离。
scene.fogRange = 40;
```

Add the above logic code example, compile and run, found in the scene covered with a layer of blue fog effect (Figure 2), the farther away the thicker, to 40 meters away from the camera will be completely shrouded in fog.

![图片2](img/2.png)

<br> （Picture 2）



### Scene light map

The lightmap is the projection of the 3D model in the scene, the shadow transition, the light atmosphere, the color effects between the model material and the material, and so on.

There are very few 3D game scenes that are instantly rendered by light and model, producing projection and color effects. This is a very lossy way, especially for mobile games. The graphics capabilities of mobile phones are not powerful, and display all of them will become very jerky with instant light and shadow games.

Scene light map is to solve this problem, it is a way to simulate the game scene light and shade, reducing a lot of real-time computing.

Lightmap It is recommended to use the unity3D editor to render the lightmap and use it for export. When loading the scene, the engine will automatically load the lightmap to achieve a better effect. Figure 1 and Figure 2 use the unity export Light map.

If the unity does not render the light map, the export engine will not load error, but the game will greatly reduce the effect. Figure 3 is not used lightmap effect, figure 4 is the use of a light texture effect, we can see clearly which one is better. Light maps are also often used to simulate the sun, night scene, game atmosphere contrast effect, enhance the game experience.
  

![图片3](img/3.png)

<br> （Picture 3）

![图片4](img/4.png)

<br> （Picture 4）

The lighting map rendering method is not explained here, the mature 3D game designer will basically make the light map.

We open the resource tree directory derived from the example code above (Figure 5).

**The name loveScene folder for unity to create a light map according to the scene name generation, the resources for the scene illumination map, the original light maps for the EXR format, to be converted to a layaAir engine in JPG or PNG format, the best in the photoShop manual transformation, can be set to 8 bit color. And stored as PNG format, which can effectively reduce the size of resources, reduce the game resource loading time.**

If you did not create lightmaps in unity, no folders will be generated.

![图片5](img/5.png)<br> （Picture 5）



If you need to use a smaller file jpg image format, converted to jpg format, you also need to modify the lls light pattern in the configuration file path, such as (Figure 6), open the scene derived data file  ”loveScene.ls" .exr format modified to .jpg, or compile the runtime engine will automatically find the png format image loading, rather than to load jpg format images.

![图片6](img/6.png)<br> （Picture 6）



