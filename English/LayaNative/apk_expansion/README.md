# Android file extension mechanism
Before the LayaPlayer-0.9.7 version, the engine could only pack the resources under the assets directory. LayaPlayer-0.9.7 or later, support for packing resources into a zip file, under any file path. LayaPlayer file system will find the existence of the file in the assets directory, if not found, go to the specified zip path. Through this zip mechanism, it can be solved by googlePlayer APK  size requirements of more than 100MB, problem of increasing the extension package.

## 1. Detailed explanation of the mechanism
### 1. Generate DCC
Test project uses DCC tools to pack resources
![图1](img/1.png)    
### 2. Compressed file
Put the resource package into the extension file, compress the cache file, the file requires the ZIP format, the file structure must keep the same structure generated by the DCC tool, as follows:
![图1](img/2.png)  
### 3. Copy the zip file to the device directory
In Android set up a directory on mobile phone /storage/emulated/0/Android/test/com.layabox.conch5, Upload test.zip to this directory
### 4. Modify the code in the expansion path
Modify RuntimeProxy.java of `getExpansionMainPath` function, set the correct zip path.
```   
    public String getExpansionMainPath()
    {
        return "/storage/emulated/0/Android/test/com.layabox.conch5/test.zip";
    }
    public String getExpansionPatchPath()
    {
        return "";
    } 
```
### 5. Open external storage permissions
Android 6.0 and above machines may not be able to read the external storage, you need to take the initiative to request permission. Please add the following code or Google related solutions.
```
    public static boolean isGrantExternalRW(Activity activity) {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M && activity.checkSelfPermission(
                Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {
            activity.requestPermissions(new String[]{
                    Manifest.permission.READ_EXTERNAL_STORAGE,
                    Manifest.permission.WRITE_EXTERNAL_STORAGE
            }, 1);
            return false;
        }
        return true;
    }
```
**TIPS:LayaPlayer supports up to two zip files, the second zip modify ·getExpansionPatchPath· function**

### 5.Running test
Running APP,  and see the following log instructions that the resource file from the main extension package
![图1](img/3.png)  
## 2. Google Play APK extension file mechanism
(https://developer.android.com/google/play/expansion-files.html)
