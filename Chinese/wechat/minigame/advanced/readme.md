# 微信小游戏综合介绍

### 一、LayaAirIDE中的小游戏发布目录详解

![img](img/1-1.png)  

（图1）

#### 1、目录内容介绍

`libs`是引擎库目录

`res`是本地资源目录（关于本地资源目录后面会重点讲）

`code.js`是采用LayaAirIDE发布为小游戏后生成的游戏项目入口文件。

`game.js`是微信小游戏的入口文件，比如游戏项目入口JS文件与适配库JS等都是在这里进行引入。

`game.json` 是小游戏的配置文件，开发者工具和客户端需要读取这个配置，完成相关界面渲染和属性设置。比如屏幕的横竖屏方向，状态栏的显示等，都是在这里配置。具体如何配置，以及参数的使用，可以[查看微信小游戏的开发文档](https://mp.weixin.qq.com/debug/wxagame/dev/index.html?t=2018115)。

`project.config.json`是微信小游戏的项目配置文件。包括了项目的一些信息，如果想修改appid等信息，可以直接在这里面编辑。

> 项目参数libVersion的值一定要是game，这里一般不会出错。但是，万一出现了LayaAirIDE里发布正常，也引用了适配库，发布为小游戏后，在开发者工具里还是有报错的话，可以检查libVersion里的值是不是game。不是的话要改为game。

`weapp-adapter.js` 是微信小游戏适配库文件，LayaAirIDE的发布工具在发布时会自动引用。





### 二、一些踩过的“坑”

#### 1、管理项目，只能创建、切换和删除。

在微信开发者工具里，项目一旦建立，没有编辑修改项目信息的地方。如果想修改项目信息，不用费力气去找这个功能了，直接删除项目重新创建即可。因为工具里的删除只会删除项目信息相关的内容，项目本身不会被删除。

在**项目**菜单里点击**查看所有项目**可以查看到当前存在的项目列表，直接点击项目，可以实现切换，点击加号创建按钮可以创建一个新项目。

如果想删除项目，点击管理项目可进入项目批量删除的界面。

![img](img/4.jpg) 

**2、读本地文件必须是ASCII编码**

之前提到每个游戏有4M本地物理存储空间，这里需要特别注意的，如果需要读取本地物理空间内的配置文件，比如json文件。由于浏览器加载文件编码没有限制，引擎没有预留编码设置接口。而小游戏里读本地资源会校验编码，所以，当小游戏本地文件的编码格式不是ASCII，那就会报错。如果有配置文件存在4M的本地包内。目前必须要改为ASCII编码，后续引擎版本计划支持编码读取设置。

> Tips：本地程序文件之间的引用（比如require或import）或者才是从网络中动态加载读取，都没有编码的校验限制。

**3、不支持loader预加载声音使用**

用LayaAir引擎开发小游戏时，要注意，不支持通过loader预加载声音文件的使用方式，声音播放直接用SoundManger音频管理类即可。

**4、缓存的大小**

微信小游戏的缓存是物理缓存，只有50M，所以对于较大型的项目，要注意控制缓存资源的使用，手动管理不常用的缓存。



### 三、实时调试的建议

在和开发者沟通中，也遇到不少的开发者存在这样的需求：就是先不使用真机调试，每次项目编译完之后，直接在开发者工具中调试，如何处理？

由于4M本地包的限制，所以我们真机调试的正式发布项目，一定要严格遵循这个规范。

假如每次编译后只是想开发工具下调试，而不是真机调试。那每次编译都调用**项目发布**功能其实没有必要，而且项目发布的速度并不快。

这种情况下，开发者可以在微信开发者工具内再创建一个仅用于调试的临时项目。这个项目创建的时候，可以将开发者工具的项目目录设置为IDE编译后的目录bin（AS3是bin/h5）,如下图所示。
![图](img/8.png)  